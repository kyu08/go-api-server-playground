desc: CreateUser
runners:
  greq: grpc://server:8080
steps:
  - desc: ユーザーが作成できる
    greq:
      twitter.TwitterService/CreateUser:
        message: {"screen_name":"screen_name", "user_name":"user_name", "bio":"bio"}
    test: |
      compare(current.res.message, {})
      && current.res.status == 0
      && current.res.headers["content-type"][0] == "application/grpc"

  # - desc: user.New()のバリデーションに違反するパラメータを指定するとエラーが返る
  #   greq:
  #     twitter.TwitterService/CreateUser:
  #       message: {"screen_name":""}
  #   test: |
  #     compare(current.res.message, "user.NewUserScreenName: screen_name is empty")
  #     && current.res.status == 2
  #     && current.res.trailers["content-type"][0] == "application/grpc"

  # - desc: screen_nameとして21文字以上の文字列を指定するとエラーが返る
  #   greq:
  #     twitter.TwitterService/CreateUser:
  #       message: {"screen_name":"012345678901234567890"}
  #   test: |
  #     compare(current.res.message, "user.NewUserScreenName: screen_name is more than max length")
  #     && current.res.status == 2
  #     && current.res.trailers["content-type"][0] == "application/grpc"
  #
  # - desc: 存在しないscreen_nameを指定するとエラーが返る
  #   greq:
  #     twitter.TwitterService/CreateUser:
  #       message: {"screen_name":"ghost"}
  #   test: |
  #     compare(current.res.message, "queries.CreateUser: user not found")
  #     && current.res.status == 2
  #     && current.res.trailers["content-type"][0] == "application/grpc"
