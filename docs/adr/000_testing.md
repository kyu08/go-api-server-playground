---
status: 'approved'
---

# 概要
本ドキュメントはこのプロジェクトのテスト方針について記載したADRである。

FIXME: とはいえE2Eがある理由ではあるけどほかの層のテストも書きたいんだよな。あとでちゃんと考える。

# 決定
- E2Eテストを整備し、handler層からDBまでを通したテストを行う。
    - ここでのE2Eテストの定義はhandler層のテストのことを指す。
- usecase層のテストは基本的には書かない。E2Eテストでカバーできるため。
- domain層のテスト基本的にカバレッジ100%を目指す。（例外がある可能性もあるので`基本的に`と書いた。）
- repositoryの実装のテストは必要であれば追加する。たとえばロジックが複雑な場合や品質が特に重要度な場合など。基本的にはE2Eテストでカバーできることが多いはずなので必要以上に書かないように注意する。

# 文脈
このリポジトリはアプリケーションアーキテクチャの検証を目的としている。そのため、内部構造（レイヤー分割、依存関係、エラーハンドリングなど）が頻繁に書き換わることが想定される。

# 論点
- 単体テストを中心に整備するか、E2Eテストを中心に整備するか
- 単体テスト中心の場合、内部構造の変更のたびにテストの修正が必要になる
- E2Eテスト中心の場合、外部インターフェース（gRPC API）が変わらなければテストの修正は不要
- テスト時にモックを使用するか、実際のDBを使用するか
    - 実行時間が課題になるまでは実際のDBを使用する。
    - モックは実行時間が短いというメリットはあるがテスト時のモック定義に実装コストがかかることが多いためである。

# 決定時に想定した影響
- 内部構造のリファクタリング時にテストの修正コストが低くなる
- 外部インターフェースの振る舞いが担保されるため、安心してリファクタリングができる
- テスト実行時にSpanner Emulatorの起動が必要となり、テスト実行時間は長くなる

# 参考
N/A
